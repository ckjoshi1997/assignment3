const fs = require('fs');
const express = require('express');
const { ApolloServer } = require('apollo-server-express');

let aboutMessage = "Issue TRacker API v1.0";

const productDB = [
  {
    id: 1, 
    category: "Jeans", 
    name: "ripped jeans", 
    price: 9.99, 
    image: "data:image/jpeg;base64,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",
  }
];

const resolvers = {
  Query: {
    about: () => aboutMessage,
    productList,
  },
  Mutation: {
    setAboutMessage,
    productAdd,
  },
};

function setAboutMessage(_, { message }) {
  return aboutMessage = message;
}

function productList() {
  return productDB;
}

function productAdd(_, { product }) {
  product.id = productDB.length + 1;
  productDB.push(product);
  return product;
}

const server = new ApolloServer({
  typeDefs: fs.readFileSync('./server/schema.graphql', 'utf-8'),
  resolvers,
});

const app = express();

app.use(express.static('public'));

server.applyMiddleware({ app, path: '/graphql' });

app.listen(3000, function () {
  console.log('App started on port 3000');
});
